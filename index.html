<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="robots" content="noindex, nofollow">

<script>
    // CHANGE THIS to your Squarespace "Join" or "Login" page URL
    const redirectUrl = "https://www.secat.app/costs"; 
    
    // CHANGE THIS to your chosen password
    const mySecret = "F!r3F10W3r"; 

    // The Logic
    const params = new URLSearchParams(window.location.search);
    if (params.get("access") !== mySecret) {
        // If the password isn't in the URL, kick them to Squarespace
        window.location.href = redirectUrl;
    }
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECAT - Summary of Engagement in Creative Arts Therapy</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Bitter:wght@700&display=swap" rel="stylesheet">

<style>
    :root {
        --primary: #2c3e50;
        --bg: #525659; 
        --border: #ccc;
        --col-A: #e74c3c; 
        --col-B: #e67e22; 
        --col-C: #f1c40f; 
        --col-D: #27ae60; 
        --col-E: #2980b9; 
    }

    body {
        font-family: 'Inter', sans-serif;
        background-color: var(--bg);
        margin: 0;
        padding: 0;
        color: #333;
        display: flex;
        height: 100vh;
        overflow: hidden;
    }

    /* --------------------------------------------------
       LAYOUT
    -------------------------------------------------- */
    .app-container { display: flex; width: 100%; height: 100%; }

    /* LEFT: EDITOR */
    .editor-panel {
        width: 35%;
        min-width: 420px;
        background: #fff;
        border-right: 1px solid #ccc;
        overflow-y: auto;
        padding: 20px;
        box-shadow: 5px 0 15px rgba(0,0,0,0.2);
        z-index: 10;
    }

    /* RIGHT: PREVIEW */
    .preview-panel {
        width: 65%;
        background-color: var(--bg);
        overflow-y: auto;
        padding: 40px;
        display: flex;
        justify-content: center;
        align-items: flex-start; /* Align to top so it grows down */
    }

    /* CONTINUOUS SHEET */
    .document-sheet {
        width: 210mm; 
        min-height: 297mm; 
        background: white;
        padding: 20mm; 
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-bottom: 40px; /* Space at bottom of scroll */
        position: relative;
    }

    /* Visual Guide for Page Breaks (Approximate) */
    .print-break {
        border-bottom: 2px dashed #eee;
        margin: 20px 0;
        position: relative;
    }
    .print-break::after {
        content: "Approx. Page Break";
        position: absolute;
        right: 0;
        top: -15px;
        font-size: 9px;
        color: #ccc;
    }

    /* --------------------------------------------------
       STYLES
    -------------------------------------------------- */
    h1 { font-family: 'Bitter', serif; font-size: 1.5rem; color: var(--primary); margin-top:0; }
    h2 { font-size: 1rem; color: #666; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 5px;}
    
    .form-group { margin-bottom: 15px; }
    label { display: block; font-weight: 600; font-size: 0.8rem; margin-bottom: 4px; }
    
    input, textarea, select {
        width: 100%;
        padding: 8px;
        border: 1px solid var(--border);
        border-radius: 4px;
        font-family: inherit;
        box-sizing: border-box;
        font-size: 0.9rem;
    }
    textarea { resize: vertical; min-height: 50px; }
    
    .auto-analysis {
        background-color: #f9f9f9;
        border-left: 3px solid var(--primary);
        font-style: italic;
        font-size: 0.85rem;
        color: #555;
    }

    .card {
        background: #fff;
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .domain-header-edit {
        font-weight: bold;
        padding: 5px 0;
        margin-bottom: 10px;
        border-bottom: 2px solid #ddd;
        color: var(--primary);
    }

    .slider-row { display: flex; justify-content: space-between; gap: 15px; margin-bottom: 5px; }
    .slider-group { flex: 1; }
    .range-input { width: 100%; cursor: pointer; accent-color: #555; }
    
    .band-indicator {
        font-size: 0.7rem; font-weight: bold; padding: 2px 6px;
        border-radius: 4px; color: white; background: #ccc;
        display: inline-block; width: 100%; text-align: center;
        margin-bottom: 8px;
    }
    .band-1 { background: #c0392b; } 
    .band-2 { background: #f39c12; } 
    .band-3 { background: #27ae60; } 

    .btn {
        background: var(--primary); color: white; border: none;
        padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%;
        margin-bottom: 10px; transition: 0.2s;
    }
    .btn:hover { background: #34495e; }
    .btn-clear { background: #95a5a6; }

    /* REPORT COMPONENTS */
    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        border-bottom: 2px solid #333;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    .header-left { display: flex; flex-direction: column; gap: 5px; }
    .logo-img { height: 50px; width: auto; object-fit: contain; margin-bottom: 10px; display: block; }
    .report-title { font-family: 'Bitter', serif; font-size: 22px; color: #000; }
    .report-meta { font-size: 11px; text-align: right; line-height: 1.5; color: #444; }

    .intro-box {
        background: #f8f9fa;
        padding: 15px;
        border-left: 5px solid var(--primary);
        font-size: 11px;
        line-height: 1.5;
        color: #444;
        break-inside: avoid; 
    }

    .quadrant-wrapper {
        display: flex;
        justify-content: center;
        width: 100%;
        margin: 20px 0;
        break-inside: avoid;
    }

    .summary-block {
        border: 1px solid #ddd;
        background: #fafafa;
        padding: 15px;
        border-radius: 4px;
        break-inside: avoid; 
    }
    .summary-block h4 { margin: 0 0 10px 0; font-size: 14px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
    .summary-text { font-size: 11px; white-space: pre-wrap; font-family: 'Inter', sans-serif; }

    .section-divider {
        border-bottom: 2px solid #333;
        margin: 20px 0 10px 0;
    }
    .section-title { font-family: 'Bitter', serif; font-size: 18px; color: #000; margin-bottom: 10px; }

    .domain-section {
        margin-bottom: 20px;
        break-inside: avoid; 
    }
    
    .domain-title-bar {
        color: white;
        padding: 8px 10px;
        font-weight: bold;
        font-size: 14px;
        border-radius: 4px 4px 0 0;
        display: flex;
        justify-content: space-between;
    }

    .report-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 11px;
        border: 1px solid #ccc;
    }
    .report-table th { background: #eee; padding: 8px; text-align: left; border: 1px solid #ccc; }
    .report-table td { padding: 8px; border: 1px solid #ccc; vertical-align: top; }
    .score-cell { text-align: center; font-weight: bold; width: 40px; }
    
    .bg-A { background-color: var(--col-A); }
    .bg-B { background-color: var(--col-B); }
    .bg-C { background-color: #d4ac0d; color: black; }
    .bg-D { background-color: var(--col-D); }
    .bg-E { background-color: var(--col-E); }

    .footer {
        margin-top: 40px;
        padding-top: 15px;
        border-top: 1px solid #eee;
        font-size: 9px;
        color: #999;
        text-align: center;
    }

    /* PRINT */
    @media print {
        body { background: white; height: auto; overflow: visible; }
        .editor-panel { display: none; }
        .preview-panel { width: 100%; padding: 0; background: white; display: block; }
        
        .document-sheet {
            width: 100%;
            min-height: 0;
            margin: 0;
            padding: 0; 
            box-shadow: none;
            border: none;
        }
        /* Hide visual helpers */
        .print-break { display: none; }
        
        button { display: none; }
        .domain-section { page-break-inside: avoid; }
        * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
</style>
</head>
<body>

<div class="app-container">
    <div class="editor-panel">
        <h1>SECAT Editor</h1>
        
        <div class="form-group">
            <button class="btn" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
            <button class="btn btn-clear" onclick="clearAllData()">Clear Form</button>
        </div>

        <div class="card">
            <h2>1. Biographical Info</h2>
            <div class="form-group"><label>Client Name</label><input type="text" id="input-name" oninput="updatePreview()"></div>
            <div class="form-group"><label>Date of Assessment</label><input type="date" id="input-date" oninput="updatePreview()"></div>
            <div class="form-group"><label>Assessor</label><input type="text" id="input-assessor" oninput="updatePreview()"></div>
            <div class="form-group"><label>Service / School</label><input type="text" id="input-service" oninput="updatePreview()"></div>
        </div>

        <div class="card">
            <h2>2. Formulation</h2>
            <label>Executive Summary</label>
            <textarea id="input-summary" oninput="updatePreview()" placeholder="Type the overall summary here..."></textarea>
            <label style="margin-top:10px">Future Aims (One per line)</label>
            <textarea id="input-aims" oninput="updatePreview()" placeholder="1. Aim one..."></textarea>
        </div>

        <div id="domains-editor"></div>
    </div>

    <div class="preview-panel">
        <div class="document-sheet">
            
            <div class="report-header">
                <div class="header-left">
                    <img src="https://via.placeholder.com/150x50?text=YOUR+LOGO+HERE" class="logo-img" alt="Logo">
                    <div class="report-title">SECAT Confidential Report</div>
                </div>
                <div class="report-meta">
                    <span id="prev-name">Client Name</span><br>
                    <span id="prev-date">Date</span><br>
                    <span id="prev-assessor">Assessor</span><br>
                    <span id="prev-service">Service</span>
                </div>
            </div>

            <div class="intro-box">
                <strong>What is SECAT?</strong><br>
                The Summary of Engagement in Creative Arts Therapy (SECAT) assesses not just the <em>amount</em> of engagement (Topography), but the <em>quality</em> of the psychological flexibility (Function). 
                <br><br>
                <strong>Understanding the Graph:</strong><br>
                ‚Ä¢ <strong>X-Axis (Flexibility):</strong> Measures adaptability. 0-3 = Rigid/Stuck. 4-6 = Rule-Following/Compliant. 7-10 = Adaptive Flow.<br>
                ‚Ä¢ <strong>Y-Axis (Engagement):</strong> Measures observable skill and participation frequency.
            </div>

            <div class="quadrant-wrapper" id="quadrant-chart"></div>

            <div class="summary-block">
                <h4>Executive Summary</h4>
                <div id="prev-summary" class="summary-text">No summary provided.</div>
            </div>

            <div class="print-break"></div>

            <div class="summary-block">
                <h4>Future Aims</h4>
                <div id="prev-aims" class="summary-text"></div>
            </div>

            <div class="section-divider"></div>
            <div class="section-title">Assessment Breakdown</div>

            <div id="domains-preview"></div>

            <div class="footer">SECAT¬© 2025. Summary of Engagement in Creative Arts Therapy.</div>

        </div>
    </div>
</div>

<script>
const domains = {
    A: { title: "A: Engagement & Participation", color: "#e74c3c", criteria: ["A1. Initiating Play", "A2. Persisting/Adapting", "A3. Attending"] },
    B: { title: "B: Emotional Expression", color: "#e67e22", criteria: ["B1. Expressing Emotions", "B2. Regulatory Use", "B3. Appropriateness"] },
    C: { title: "C: Social Interaction", color: "#f1c40f", criteria: ["C1. Turn-taking", "C2. Collaborating", "C3. Communication Mode"] },
    D: { title: "D: Interaction with Media", color: "#27ae60", criteria: ["D1. Control/Manipulation", "D2. Physical Presence", "D3. Expressive Range"] },
    E: { title: "E: Cognitive Skills", color: "#2980b9", criteria: ["E1. Recalling Moments", "E2. Sequencing Ideas", "E3. Problem Solving"] }
};

const analysisMap = {
    A: [
        ["Engagement limited by rigid adherence to a single idea.", "Initiated only when explicitly prompted (Compliance).", "Initiated new creative ideas spontaneously (Flow)."],
        ["Withdrew when musical demand increased (Avoidance).", "Persisted but struggled to adapt to tempo changes.", "Seamlessly adapted play to match context changes."],
        ["Play was disconnected from the shared pulse.", "Attended to mechanics rather than the shared music.", "Demonstrated deep contact with the present moment."]
    ],
    B: [
        ["Affect was flat or incongruent with activity.", "Labelled emotions correctly but appeared detached.", "Demonstrated congruence between affect and activity."],
        ["Used the medium to drown out/mask feelings.", "Expression felt performative or scripted.", "Used the arts to safely hold difficult emotions."],
        ["Struggled to tolerate silence or stillness.", "Regulated by strictly controlling the activity.", "Shifted emotional state adaptively."]
    ],
    C: [
        ["Struggled to distinguish 'my turn' vs 'your turn'.", "Turn-taking was polite but rule-bound.", "Anticipated the other's entry naturally (I-YOU framing)."],
        ["Play was parallel/isolated; ignored social cues.", "Waited for permission to enter the shared space.", "Collaborated to build a shared creative product."],
        ["Communication was purely functional (needs-based).", "Social engagement maintained through compliance.", "Communication served to build connection."]
    ],
    D: [
        ["Interaction with medium was mechanical/repetitive.", "Used tools correctly but relied on instruction.", "Adapted technical use of medium intuitively."],
        ["Physical presence appeared rigid or static.", "Adopted a 'learning' posture; focused on correctness.", "Physical embodiment was congruent with session energy."],
        ["Limited to a single dynamic level (e.g., always loud).", "Varied dynamics only when directed (Pliance).", "Utilized full expressive range."]
    ],
    E: [
        ["Recall was vague; unable to link past to present.", "Listed events accurately but lacked personal meaning.", "Derived causal connections between action and outcome."],
        ["Sequencing was chaotic or stuck in a loop.", "Relied on safe, standard structures.", "Sequencing was logical and creative."],
        ["Gave up immediately when problem-solving failed.", "Solved problems by seeking adult help.", "Experimented independently to overcome obstacles."]
    ]
};

(function initApp() {
    const editorRoot = document.getElementById('domains-editor');
    const previewRoot = document.getElementById('domains-preview');

    if(!editorRoot || !previewRoot) return;

    Object.keys(domains).forEach(key => {
        const d = domains[key];
        
        // EDITOR
        const section = document.createElement('div');
        section.className = 'card';
        section.innerHTML = `<div class="domain-header-edit" style="color:${d.color}">${d.title}</div>`;
        
        d.criteria.forEach((cLabel, idx) => {
            const cid = `${key}${idx+1}`;
            section.innerHTML += `
                <div style="margin-bottom: 15px;">
                    <label>${cLabel}</label>
                    <div class="slider-row">
                        <div class="slider-group">
                            <span style="font-size:0.7rem">Engagement: <b id="val-eng-${cid}">0</b></span>
                            <input type="range" class="range-input" id="eng-${cid}" min="0" max="10" value="0" oninput="window.handleInput('${cid}', '${key}', ${idx})">
                        </div>
                        <div class="slider-group">
                            <span style="font-size:0.7rem">Flexibility: <b id="val-flex-${cid}">0</b></span>
                            <input type="range" class="range-input" id="flex-${cid}" min="0" max="10" value="0" oninput="window.handleInput('${cid}', '${key}', ${idx})">
                        </div>
                    </div>
                    <div class="band-indicator band-1" id="band-${cid}">0 - Stuck</div>
                    <div style="margin-top:5px;">
                        <label style="font-size:0.7rem; color:#888;">Analysis</label>
                        <textarea id="auto-${cid}" class="auto-analysis" oninput="window.updatePreview()"></textarea>
                        <label style="font-size:0.7rem; color:#888; margin-top:5px;">Notes</label>
                        <textarea id="note-${cid}" placeholder="Context..." oninput="window.updatePreview()"></textarea>
                    </div>
                </div>
            `;
        });
        
        section.innerHTML += `<label>Overall ${key} Summary</label><textarea id="sum-${key}" oninput="window.updatePreview()"></textarea>`;
        editorRoot.appendChild(section);

        // PREVIEW
        const prevDiv = document.createElement('div');
        prevDiv.className = 'domain-section';
        const bgClass = `bg-${key}`;
        prevDiv.innerHTML = `
            <div class="domain-title-bar ${bgClass}"><span>${d.title}</span></div>
            <table class="report-table">
                <thead><tr><th width="35%">Criteria</th><th width="8%">Eng.</th><th width="8%">Flex.</th><th>Analysis & Notes</th></tr></thead>
                <tbody id="tbody-${key}"></tbody>
            </table>
            <div id="prev-sum-${key}" style="font-size:11px; padding:10px; background:#fafafa; border:1px solid #ccc; border-top:0; font-style:italic;"></div>
        `;
        previewRoot.appendChild(prevDiv);
    });
    
    setTimeout(window.updatePreview, 100);
})();

window.handleInput = function(cid, domainKey, cIdx) {
    const eng = document.getElementById(`eng-${cid}`).value;
    const flex = document.getElementById(`flex-${cid}`).value;
    document.getElementById(`val-eng-${cid}`).innerText = eng;
    document.getElementById(`val-flex-${cid}`).innerText = flex;

    const bandEl = document.getElementById(`band-${cid}`);
    let bandIdx = 0;
    if (flex <= 3) { bandEl.className = "band-indicator band-1"; bandEl.innerText = `${flex} - Rigid/Stuck`; bandIdx = 0; }
    else if (flex <= 6) { bandEl.className = "band-indicator band-2"; bandEl.innerText = `${flex} - Pliance/Rule`; bandIdx = 1; }
    else { bandEl.className = "band-indicator band-3"; bandEl.innerText = `${flex} - Flow/Adaptive`; bandIdx = 2; }

    const phrase = analysisMap[domainKey][cIdx][bandIdx];
    const autoBox = document.getElementById(`auto-${cid}`);
    autoBox.value = phrase;

    window.updatePreview();
    window.updateChart();
};

window.updatePreview = function() {
    document.getElementById('prev-name').innerText = document.getElementById('input-name').value || "Client Name";
    document.getElementById('prev-date').innerText = document.getElementById('input-date').value || "Date";
    document.getElementById('prev-assessor').innerText = document.getElementById('input-assessor').value || "Assessor";
    document.getElementById('prev-service').innerText = document.getElementById('input-service').value || "Service";

    document.getElementById('prev-summary').innerText = document.getElementById('input-summary').value || "No summary provided.";
    
    const aimsTxt = document.getElementById('input-aims').value;
    const aimsDiv = document.getElementById('prev-aims');
    aimsDiv.innerHTML = "";
    if (aimsTxt) {
        const ul = document.createElement('ul');
        ul.style.margin = "0"; ul.style.paddingLeft = "15px";
        aimsTxt.split('\n').forEach(line => { if(line.trim()) ul.innerHTML += `<li>${line}</li>`; });
        aimsDiv.appendChild(ul);
    }

    Object.keys(domains).forEach(key => {
        const tbody = document.getElementById(`tbody-${key}`);
        if(tbody) {
            tbody.innerHTML = "";
            domains[key].criteria.forEach((cLabel, idx) => {
                const cid = `${key}${idx+1}`;
                const eng = document.getElementById(`eng-${cid}`).value;
                const flex = document.getElementById(`flex-${cid}`).value;
                const autoTxt = document.getElementById(`auto-${cid}`).value;
                const noteTxt = document.getElementById(`note-${cid}`).value;
                let combinedTxt = `<span>${autoTxt}</span>`;
                if(noteTxt) combinedTxt += `<br><span style="color:#555; font-style:italic;">Note: ${noteTxt}</span>`;
                tbody.innerHTML += `<tr><td>${cLabel}</td><td class="score-cell" style="background:${eng > 0 ? '#eee' : '#fff'}">${eng}</td><td class="score-cell" style="background:${getFlexColor(flex)}">${flex}</td><td>${combinedTxt}</td></tr>`;
            });
            document.getElementById(`prev-sum-${key}`).innerText = document.getElementById(`sum-${key}`).value;
        }
    });
    window.updateChart();
};

window.getFlexColor = function(val) {
    if (val == 0) return "#fff";
    if (val <= 3) return "#fadbd8"; 
    if (val <= 6) return "#fdebd0"; 
    return "#d5f5e3"; 
};

window.updateChart = function() {
    const container = document.getElementById('quadrant-chart');
    if(!container) return;
    container.innerHTML = ""; 
    
    // INCREASED CANVAS + MARGINS
    const width = 500, height = 500, margin = 60;
    const svg = d3.select("#quadrant-chart").append("svg").attr("width", width).attr("height", height).attr("viewBox", `0 0 ${width} ${height}`);
    const g = svg.append("g").attr("transform", `translate(${margin},${margin})`);
    const innerW = width - margin*2; 
    const innerH = height - margin*2;
    
    // SCALES: -2 to 12 (Zoomed Out)
    const x = d3.scaleLinear().domain([-2, 12]).range([0, innerW]);
    const y = d3.scaleLinear().domain([-2, 12]).range([innerH, 0]); 

    // CROSSHAIRS
    g.append("line").attr("x1", x(5)).attr("y1", y(-2)).attr("x2", x(5)).attr("y2", y(12)).attr("stroke", "#ccc").attr("stroke-dasharray", "4");
    g.append("line").attr("x1", x(-2)).attr("y1", y(5)).attr("x2", x(12)).attr("y2", y(5)).attr("stroke", "#ccc").attr("stroke-dasharray", "4");

    // AXIS LABELS (High Eng / Flow etc)
    g.append("text").attr("x", x(5)).attr("y", y(12)).text("HIGH ENGAGEMENT").attr("text-anchor", "middle").style("font-size", "9px").style("fill", "#555").style("font-weight","bold");
    g.append("text").attr("x", x(5)).attr("y", y(-2)+8).text("LOW ENGAGEMENT").attr("text-anchor", "middle").style("font-size", "9px").style("fill", "#555").style("font-weight","bold");
    g.append("text").attr("x", x(-2)).attr("y", y(5)+3).text("RIGID").attr("text-anchor", "start").style("font-size", "9px").style("fill", "#555").style("font-weight","bold");
    g.append("text").attr("x", x(12)).attr("y", y(5)+3).text("FLOW").attr("text-anchor", "end").style("font-size", "9px").style("fill", "#555").style("font-weight","bold");

    // CORNER LABELS (Pushed out to -1.5 and 11.5)
    g.append("text").attr("x", x(-1.5)).attr("y", y(11.5)).text("RIGID / STUCK").attr("text-anchor", "start").style("font-size", "10px").style("fill", "#c0392b").style("font-weight", "bold");
    g.append("text").attr("x", x(11.5)).attr("y", y(11.5)).text("FLOW / ADAPTIVE").attr("text-anchor", "end").style("font-size", "10px").style("fill", "#27ae60").style("font-weight", "bold");
    g.append("text").attr("x", x(-1.5)).attr("y", y(-1.5)).text("AVOIDANT").attr("text-anchor", "start").style("font-size", "10px").style("fill", "#7f8c8d").style("font-weight", "bold");
    g.append("text").attr("x", x(11.5)).attr("y", y(-1.5)).text("OBSERVER").attr("text-anchor", "end").style("font-size", "10px").style("fill", "#2980b9").style("font-weight", "bold");

    // DATA
    let points = [];
    Object.keys(domains).forEach(key => {
        domains[key].criteria.forEach((_, idx) => {
            const cid = `${key}${idx+1}`;
            const eng = +document.getElementById(`eng-${cid}`).value;
            const flex = +document.getElementById(`flex-${cid}`).value;
            if (eng > 0 || flex > 0) points.push({ id: cid, eng: eng, flex: flex, color: domains[key].color });
        });
    });

    const grouped = {};
    points.forEach(p => {
        const key = `${p.flex}-${p.eng}`;
        if (!grouped[key]) grouped[key] = [];
        grouped[key].push(p);
    });

    let finalData = [];
    Object.values(grouped).forEach(group => {
        if (group.length === 1) {
            group[0].dx = 0; group[0].dy = 0;
            finalData.push(group[0]);
        } else {
            const radius = 15; 
            const step = (2 * Math.PI) / group.length;
            group.forEach((p, i) => {
                p.dx = Math.cos(step * i) * radius;
                p.dy = Math.sin(step * i) * radius;
                finalData.push(p);
            });
        }
    });

    g.selectAll("circle").data(finalData).enter().append("circle")
        .attr("cx", d => x(d.flex) + d.dx).attr("cy", d => y(d.eng) + d.dy)
        .attr("r", 6).attr("fill", d => d.color).attr("stroke", "#fff").attr("stroke-width", 1);

    g.selectAll(".label").data(finalData).enter().append("text")
        .attr("x", d => x(d.flex) + d.dx).attr("y", d => y(d.eng) + d.dy - 8)
        .text(d => d.id).attr("text-anchor", "middle").attr("font-size", "9px").attr("font-weight", "bold").attr("fill", "#333");
};

window.clearAllData = function() {
    if(confirm("Clear all data?")) {
        document.querySelectorAll('input').forEach(el => el.value = '');
        document.querySelectorAll('textarea').forEach(el => el.value = '');
        document.querySelectorAll('input[type="range"]').forEach(el => el.value = 0);
        Object.keys(domains).forEach(k => { domains[k].criteria.forEach((_, i) => window.handleInput(`${k}${i+1}`, k, i)); });
        window.updatePreview();
    }
};
</script>
</body>
</html>
